<html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - 你的个人主页</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, addDoc, collection, onSnapshot, query, orderBy, updateDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        window.firebase = {
            initializeApp,
            getAuth, signInAnonymously, onAuthStateChanged,
            getFirestore, doc, getDoc, setDoc, addDoc, collection, onSnapshot, query, orderBy, updateDoc, deleteDoc, serverTimestamp
        };
    </script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'primary': '#007aff',
                        'light-bg': '#f7f7f7',
                        'dark-bg': '#0d1117',
                        'light-card': 'rgba(255, 255, 255, 0.65)',
                        'dark-card': 'rgba(28, 28, 30, 0.55)',
                        'light-text': '#1d1d1f',
                        'dark-text': '#f5f5f7',
                        'light-subtle': '#6e6e73',
                        'dark-subtle': '#86868b',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    keyframes: {
                        gradient: { '0%': { backgroundPosition: '0% 50%' }, '50%': { backgroundPosition: '100% 50%' }, '100%': { backgroundPosition: '0% 50%' } },
                        fadeIn: { '0%': { opacity: 0, transform: 'translateY(10px)' }, '100%': { opacity: 1, transform: 'translateY(0)' } },
                        slideIn: { '0%': { opacity: 0, transform: 'translateX(-10px)' }, '100%': { opacity: 1, transform: 'translateX(0)' } },
                    },
                    animation: {
                        gradient: 'gradient 15s ease infinite',
                        fadeIn: 'fadeIn 0.5s ease-out forwards',
                        slideIn: 'slideIn 0.3s ease-out forwards',
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        /* Base & Background */
        body {
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        .light-theme-bg { background-image: linear-gradient(-45deg, #fbc2eb, #a6c1ee, #fbc2eb, #a6c1ee); }
        .dark-theme-bg { background-image: linear-gradient(-45deg, #0d1a26, #2a4a69, #0d1a26, #2a4a69); }
        
        /* Glassmorphism Card */
        .glass-card {
            -webkit-backdrop-filter: blur(25px);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-shadow: 0 1px 1px rgba(0,0,0,0.05);
        }

        /* Custom UI Styles */
        .tab-btn.active { @apply bg-white/30 dark:bg-black/30; }
        .todo-item input:checked + span { @apply line-through text-light-subtle dark:text-dark-subtle; }
        .tooltip { @apply invisible opacity-0 transition-opacity duration-200; }
        .has-tooltip:hover .tooltip { @apply visible opacity-100; }
        #todo-list li { animation: slideIn 0.3s ease-out forwards; }
    </style>
</head>
<body class="font-sans antialiased text-light-text dark:text-dark-text transition-colors duration-500">

    <main class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-xl mx-auto glass-card bg-light-card dark:bg-dark-card rounded-3xl shadow-2xl p-6 space-y-6" style="animation: fadeIn 0.8s ease-out;">
            
            <div class="text-center">
                <div id="greeting" class="text-xl font-medium text-light-subtle dark:text-dark-subtle mb-2">下午好</div>
                <div id="clock" class="text-6xl md:text-7xl font-bold tracking-tight">16:45</div>
                <div id="date" class="text-lg text-light-subtle dark:text-dark-subtle">2025年9月15日 星期一</div>
            </div>

            <div class="relative">
                <i class="fa fa-search absolute left-5 top-1/2 -translate-y-1/2 text-xl text-light-subtle dark:text-dark-subtle"></i>
                <input type="text" id="search-input" placeholder="使用必应搜索或输入网址..." class="w-full bg-black/5 dark:bg-white/5 rounded-full h-14 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-primary text-lg">
            </div>

            <div>
                <div class="flex items-center bg-black/5 dark:bg-white/5 rounded-full p-1 mb-4">
                    <button id="todo-tab-btn" class="tab-btn active w-1/2 h-9 rounded-full transition-colors text-sm font-medium">今日待办</button>
                    <button id="pomodoro-tab-btn" class="tab-btn w-1/2 h-9 rounded-full transition-colors text-sm font-medium">专注时钟</button>
                </div>

                <div id="tab-content" class="min-h-[250px] p-2">
                    <div id="todo-content">
                        <form id="todo-form" class="flex items-center gap-2 mb-4">
                            <input type="text" id="todo-input" placeholder="添加新任务..." class="w-full h-10 bg-black/5 dark:bg-white/5 rounded-lg px-3 focus:outline-none focus:ring-2 focus:ring-primary">
                            <button type="submit" class="w-10 h-10 bg-primary text-white rounded-lg flex-shrink-0 hover:bg-opacity-80 transition transform hover:scale-105"><i class="fa fa-plus"></i></button>
                        </form>
                        <ul id="todo-list" class="space-y-2 max-h-[160px] overflow-y-auto pr-2"></ul>
                         <div id="todo-placeholder" class="hidden text-center text-light-subtle dark:text-dark-subtle pt-10">
                            <i class="fa fa-check-square-o text-4xl mb-2"></i>
                            <p>今日事今日毕</p>
                        </div>
                    </div>

                    <div id="pomodoro-content" class="hidden text-center flex flex-col items-center justify-center h-full">
                        <div id="pomodoro-timer" class="text-6xl font-bold mb-4">25:00</div>
                        <div class="flex gap-4">
                            <button id="pomodoro-start-btn" class="w-24 h-10 bg-primary text-white rounded-full font-medium hover:bg-opacity-80 transition">开始</button>
                            <button id="pomodoro-reset-btn" class="w-24 h-10 bg-black/10 dark:bg-white/10 rounded-full font-medium hover:bg-black/20 dark:hover:bg-white/20 transition">重置</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="fixed bottom-4 left-1/2 -translate-x-1/2">
        <div id="dock" class="flex items-center justify-center gap-1 glass-card bg-light-card/80 dark:bg-dark-card/80 p-2 rounded-full shadow-2xl transition-all duration-300 hover:gap-3">
        </div>
    </footer>
    
    <div class="fixed top-4 right-4 flex space-x-2">
         <button id="theme-toggle" class="w-10 h-10 flex items-center justify-center glass-card bg-light-card/80 dark:bg-dark-card/80 text-lg rounded-full hover:bg-white/50 dark:hover:bg-black/50 transition-colors">
            <i class="fa" id="theme-icon"></i>
        </button>
    </div>

    <script type="module">
        const { initializeApp, getAuth, signInAnonymously, onAuthStateChanged, getFirestore, doc, getDoc, setDoc, addDoc, collection, onSnapshot, query, orderBy, updateDoc, deleteDoc, serverTimestamp } = window.firebase;
        
        // Firebase config is provided by the environment.
        const firebaseConfig = typeof __firebase_config !== 'undefined'
            ? JSON.parse(__firebase_config)
            : {
                // This is a fallback for local development and should be replaced by the environment's config.
                apiKey: "YOUR_FALLBACK_API_KEY", 
                authDomain: "YOUR_FALLBACK_PROJECT_ID.firebaseapp.com",
                projectId: "YOUR_FALLBACK_PROJECT_ID",
                storageBucket: "YOUR_FALLBACK_PROJECT_ID.appspot.com",
                messagingSenderId: "YOUR_FALLBACK_SENDER_ID",
                appId: "YOUR_FALLBACK_APP_ID"
              };

        let app;
        let auth;
        let db;
        let userId;

        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            onAuthStateChanged(auth, handleAuthState);
        } catch (e) {
            console.error("Firebase initialization failed:", e);
            // You could display a message to the user here.
        }


        const DOCK_ITEMS = [ { name: 'Bilibili', href: 'https://www.bilibili.com', icon: 'fa-television' }, { name: 'GitHub', href: 'https://github.com', icon: 'fa-github' }, { name: '知乎', href: 'https://www.zhihu.com', icon: 'fa-book' }, { name: 'QQ音乐', href: 'https://y.qq.com', icon: 'fa-music' }, { name: '微博', href: 'https://weibo.com', icon: 'fa-weibo' }, ];
        const SEARCH_ENGINE_URL = 'https://www.bing.com/search?q=';
        
        const body = document.body;
        const greetingEl = document.getElementById('greeting');
        const clockEl = document.getElementById('clock');
        const dateEl = document.getElementById('date');
        const searchInput = document.getElementById('search-input');
        const dock = document.getElementById('dock');
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const todoTabBtn = document.getElementById('todo-tab-btn');
        const pomodoroTabBtn = document.getElementById('pomodoro-tab-btn');
        const todoContent = document.getElementById('todo-content');
        const pomodoroContent = document.getElementById('pomodoro-content');
        const todoForm = document.getElementById('todo-form');
        const todoInput = document.getElementById('todo-input');
        const todoList = document.getElementById('todo-list');
        const todoPlaceholder = document.getElementById('todo-placeholder');
        const pomodoroTimerEl = document.getElementById('pomodoro-timer');
        const pomodoroStartBtn = document.getElementById('pomodoro-start-btn');
        const pomodoroResetBtn = document.getElementById('pomodoro-reset-btn');
        let pomodoroInterval, pomodoroTime = 25 * 60, isPomodoroRunning = false;
        
        const applyTheme = (theme) => {
            document.documentElement.classList.toggle('dark', theme === 'dark');
            body.classList.toggle('dark-theme-bg', theme === 'dark');
            body.classList.toggle('light-theme-bg', theme !== 'dark');
            themeIcon.className = theme === 'dark' ? 'fa fa-sun-o' : 'fa fa-moon-o';
            if (userId) setDoc(doc(db, "users", userId, "settings", "theme"), { mode: theme });
        };
        
        const toggleTheme = () => applyTheme(document.documentElement.classList.contains('dark') ? 'light' : 'dark');

        const updateClockAndDate = () => {
            const now = new Date();
            const hour = now.getHours();
            if (hour < 6) greetingEl.textContent = "凌晨了，注意休息";
            else if (hour < 12) greetingEl.textContent = "上午好";
            else if (hour < 14) greetingEl.textContent = "中午好";
            else if (hour < 18) greetingEl.textContent = "下午好";
            else greetingEl.textContent = "晚上好";
            clockEl.textContent = now.toTimeString().substring(0, 5);
            dateEl.textContent = `${now.getFullYear()}年${now.getMonth() + 1}月${now.getDate()}日 ${new Intl.DateTimeFormat('zh-CN', { weekday: 'long' }).format(now)}`;
        };
        
        const renderDock = () => {
            dock.innerHTML = '';
            DOCK_ITEMS.forEach(item => {
                dock.innerHTML += `
                    <a href="${item.href}" target="_blank" class="w-12 h-12 flex items-center justify-center text-2xl rounded-full relative has-tooltip transition-all duration-300 hover:bg-black/10 dark:hover:bg-white/10 transform hover:scale-110">
                        <i class="fa ${item.icon}"></i>
                        <div class="tooltip absolute bottom-full mb-2 px-3 py-1 bg-black/80 text-white text-xs rounded-md whitespace-nowrap">${item.name}</div>
                    </a>
                `;
            });
        };
        
        const handleSearch = () => {
            const query = searchInput.value.trim();
            if (!query) return;
            const url = (query.startsWith('http') || query.includes('.')) ? (query.startsWith('http') ? query : `https://${query}`) : `${SEARCH_ENGINE_URL}${encodeURIComponent(query)}`;
            window.open(url, '_blank');
            searchInput.value = '';
        };
        
        const renderTodos = (todos) => {
            todoList.innerHTML = '';
            todoPlaceholder.classList.toggle('hidden', todos.length > 0);
            todos.forEach(todo => {
                const li = document.createElement('li');
                li.className = 'flex items-center bg-black/5 dark:bg-white/5 p-2 rounded-lg';
                li.innerHTML = `
                    <label class="flex-grow flex items-center cursor-pointer">
                        <input type="checkbox" data-id="${todo.id}" class="mr-3 h-5 w-5 rounded-md text-primary focus:ring-primary border-gray-300" ${todo.done ? 'checked' : ''}>
                        <span class="flex-grow">${todo.text}</span>
                    </label>
                    <button data-id="${todo.id}" class="delete-todo-btn w-7 h-7 text-sm text-light-subtle dark:text-dark-subtle hover:text-red-500 transition"><i class="fa fa-trash-o"></i></button>
                `;
                todoList.appendChild(li);
            });
        };
        
        const updatePomodoroDisplay = () => {
            pomodoroTimerEl.textContent = `${String(Math.floor(pomodoroTime / 60)).padStart(2, '0')}:${String(pomodoroTime % 60).padStart(2, '0')}`;
        };
        const startPomodoro = () => { if (!isPomodoroRunning) { isPomodoroRunning = true; pomodoroStartBtn.textContent = '暂停'; pomodoroInterval = setInterval(() => { pomodoroTime--; updatePomodoroDisplay(); if (pomodoroTime <= 0) { stopPomodoro(); alert('专注时间结束！'); } }, 1000); } };
        const stopPomodoro = () => { clearInterval(pomodoroInterval); isPomodoroRunning = false; pomodoroStartBtn.textContent = '开始'; };
        const resetPomodoro = () => { stopPomodoro(); pomodoroTime = 25 * 60; updatePomodoroDisplay(); };

        const switchTab = (tab) => {
            const isTodo = tab === 'todo';
            todoTabBtn.classList.toggle('active', isTodo);
            pomodoroTabBtn.classList.toggle('active', !isTodo);
            todoContent.classList.toggle('hidden', !isTodo);
            pomodoroContent.classList.toggle('hidden', isTodo);
        };
        
        async function handleAuthState(user) {
            if (user) {
                userId = user.uid;
                // Load theme
                const themeDoc = await getDoc(doc(db, "users", userId, "settings", "theme"));
                applyTheme(themeDoc.exists() ? themeDoc.data().mode : 'light');
                
                // Listen for Todos
                const q = query(collection(db, "users", userId, "todos"), orderBy("createdAt", "desc"));
                onSnapshot(q, (snapshot) => {
                    const todos = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderTodos(todos);
                }, (error) => {
                    console.error("Error listening to todos:", error);
                });
            } else {
                signInAnonymously(auth).catch(error => {
                    console.error("Anonymous sign-in failed:", error);
                });
            }
        }

        const setupEventListeners = () => {
            themeToggle.addEventListener('click', toggleTheme);
            searchInput.addEventListener('keydown', (e) => e.key === 'Enter' && handleSearch());
            todoTabBtn.addEventListener('click', () => switchTab('todo'));
            pomodoroTabBtn.addEventListener('click', () => switchTab('pomodoro'));
            todoForm.addEventListener('submit', async (e) => { e.preventDefault(); const text = todoInput.value.trim(); if (text && userId) { await addDoc(collection(db, "users", userId, "todos"), { text, done: false, createdAt: serverTimestamp() }); todoInput.value = ''; } });
            todoList.addEventListener('click', (e) => {
                const id = e.target.dataset.id;
                if (!id || !userId) return;
                if (e.target.type === 'checkbox') updateDoc(doc(db, "users", userId, "todos", id), { done: e.target.checked });
                if (e.target.closest('.delete-todo-btn')) deleteDoc(doc(db, "users", userId, "todos", id));
            });
            pomodoroStartBtn.addEventListener('click', () => isPomodoroRunning ? stopPomodoro() : startPomodoro());
            pomodoroResetBtn.addEventListener('click', resetPomodoro);
        };

        // --- Init App ---
        updateClockAndDate();
        setInterval(updateClockAndDate, 1000);
        renderDock();
        setupEventListeners();
    </script>

</body></html>

